filter {
    ## don't process any events we know are going to be fed to the tcp output.
    ## this tag won't appear in the input because @tags overwrites tags.
    if "codec:oldlogstashjson" in [@tags] and "beaver" in [@tags] {
        mutate {
            add_tag => [ "filter_through_tcp" ]
            
            ## preserve original host because tcp adds its own host field
            rename => [ "[@fields][host]", "[@fields][_host]" ]
        }
    }
    
    if "tcp_input" in [tags] {
        mutate {
            ## restore the host field
            rename => [ "_host", "host" ]
        }
    }
}
