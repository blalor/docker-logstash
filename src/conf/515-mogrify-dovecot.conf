filter {
    if [type] == "syslog" and [program] == "dovecot" {
        kv {
            field_split => ", "
        }

        ## lda(some-user): msgid=<CAL_=KJKCrFLW7PzoJvPyUcXd-yigWZzrTHQuHt4MR67iytEoDA@mail.gmail.com>: saved mail to INBOX
        ## "component" (lda, etc.) and user
        grok {
            match => {
                "message" => "(?<component>\b(\w-?)+\b)(\(%{USERNAME:user}\))?: %{GREEDYDATA:message}"
            }
            
            overwrite => "message"
        }
        
        if [component] == "lda" {
            grok {
                match => {
                    "message" => "msgid=<%{GREEDYDATA:message_id}>: saved mail to (?<dest_folder>.*)"
                }
            }
            
            mutate {
                remove_field => [ "msgid" ]
            }
        }
        
        mutate {
            gsub => [
                "user", "[<>]", ""
            ]
        }
    }
}
